<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Language" content="en">
    <title>Admin - AIT</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      /* Add your CSS styles for the table here */
      .review-cell {
        padding: 0px 200px !important;
      }
      .message-cell {
        padding: 0px 200px !important;
      }
      .subject-cell {
        padding: 0px 100px !important;
      }
      #reviewsTable,
      #contactTable,
      #enquiryTable,
      #employee,
      #employeeTable {
        display: none;
      }
      .nav-item .nav-link:hover {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <nav class="navbar bg-dark sticky-top mb-lg-3">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <h1 class="text-light">Admin Dashboard</h1>
        </a>
        <button
          class="navbar-toggler bg-light"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasNavbar"
          aria-controls="offcanvasNavbar"
          aria-label="Toggle navigation"
        >
          <span
            class="navbar-toggler-icon"
            style="background-color: white; color: white"
          ></span>
        </button>
        <div
          class="offcanvas offcanvas-end"
          tabindex="-1"
          id="offcanvasNavbar"
          aria-labelledby="offcanvasNavbarLabel"
        >
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Open</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="offcanvas"
              aria-label="Close"
            ></button>
          </div>
          <div class="offcanvas-body">
            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
              <li class="nav-item">
                <a
                  class="nav-link"
                  onclick="showReviews()"
                  data-bs-dismiss="offcanvas"
                  >Show Reviews</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  onclick="showEnquires()"
                  data-bs-dismiss="offcanvas"
                  >Show Enquires</a
                >
              </li>

              <li class="nav-item">
                <a
                  class="nav-link"
                  onclick="showContacts()"
                  data-bs-dismiss="offcanvas"
                  >Show Contacts</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  onclick="showEmployee()"
                  data-bs-dismiss="offcanvas"
                  >Show Employees</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  onclick="showAddEmployee()"
                  data-bs-dismiss="offcanvas"
                  >Add Employee</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>
<!-- reviews table -->
    <table
      id="reviewsTable"
      class="table table-striped table-hover table-bordered"
    >
      <thead>
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>Rating</th>
          <th class="review-cell">Review</th>
          <th>Created At</th>
          <th>Show</th>
          <th>Show Review</th>
          <th>Delete Review</th>
        </tr>
      </thead>
      <tbody id="reviewsBody">
        <!-- Unique ID for reviews -->
        <!-- Reviews will be dynamically added here -->
      </tbody>
    </table>

    <!-- Contact table -->
    <table
      id="contactTable"
      class="table table-striped table-hover table-bordered"
    >
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th class="subject-cell">Subject</th>
          <th class="message-cell">Message</th>
          <th>Created At</th>
        </tr>
      </thead>
      <tbody id="contactBody">
        <!-- Unique ID for contact data -->
        <!-- Contact data will be dynamically added here -->
      </tbody>
    </table>

    <!-- Enquiry table -->
    <table
      id="enquiryTable"
      class="table table-striped table-hover table-bordered"
    >
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Email</th>
          <th>College</th>
          <th>Course Intrested</th>
          <th>Syllabus Downloaded</th>
          <th>Home Address</th>
          <th>Created At</th>
        </tr>
      </thead>
      <tbody id="enquiryBody">
        <!-- Unique ID for contact data -->
        <!-- Contact data will be dynamically added here -->
      </tbody>
    </table>

    <!-- Add Employee -->

    <div class="col-8 offset-2 main-content" id="employee">
      <h2 class="mt-3">Add Employee</h2>

      <form
        id="addEmployeeForm"
        method="POST"
      >
        <div class="mb-3">
          <label for="fname" class="form-label" 
            >First Name</label
          >
          <input
            type="text"
            class="form-control"
            id="fname"
            name="fname"
            required
          />
        </div>
        <div class="mb-3">
          <label
            for="lname"
            class="form-label"
            
            >Last Name</label
          >
          <input
            type="text"
            class="form-control"
            id="lname"
            name="lname"
            required
          />
        </div>
        <div class="mb-3">
          <label for="designation" class="form-label" 
            >Designation</label
          >
          <input
            class="form-control"
            id="designation"
            name="designation"
            type="text"
            required
          ></input>
        </div>
        <div class="mb-3">
          <label for="joinedOn" class="form-label" 
            >JoinedOn</label
          >
          <input
            class="form-control"
            id="joinedOn"
            name="joinedOn"
            type="date"
            required
          ></input>
        </div>
        <div class="mb-3">
          <label for="blogImage" class="form-label" 
            >Choose Image</label
          >

          <input
            id="upload_widget"
            class="form-control"
            name="bimage"
            required
            value="Upload Image"
          />
        </div>
        <button
          type="submit"
          name="submit"
          class="btn btn-primary"
          id="addEmployee"
        >
          Add Employee
        </button>
      </form>
    </div>
<!-- Show Employee -->
    <table
    id="employeeTable"
    class="table table-striped table-hover table-bordered"
  >
    <thead>
      <tr>
        <th>Name</th>
        <th>Designation</th>
        <th>Image</th>
        <th>Joined On </th>
        <th>Update</th>
        <th>Remove Employee</th>
      </tr>
    </thead>
    <tbody id="employeeBody">

    </tbody>
  </table>

    <script>
      // Fetch reviews from the server
      async function fetchReviews() {
        try {
          const response = await fetch("http://localhost:3000/api/getreviews"); // Assuming '/api/reviews' is your endpoint
          const data = await response.json();
          console.log(data);
          if (data.success) {
            displayReviews(data.reviews);
          } else {
            console.error(data.message);
          }
        } catch (error) {
          console.error("Error fetching reviews:", error);
        }
      }

      function convertToIST(utcTime) {
        const istTime = new Date(utcTime);
        return istTime.toLocaleString();
      }

      // Function to handle update review
      async function handleUpdateReview(reviewId) {
        try {
          const response = await fetch(
            `http://localhost:3000/api/update-review/${reviewId}`,
            {
              method: "PUT", // Assuming POST method is used for update
            }
          );
          const data = await response.json();
          if (data.success == true) {
            return window.location.reload();
          }
          // Handle response as needed
        } catch (error) {
          console.error("Error updating review:", error);
        }
      }

      // Function to handle delete review
      async function handleDeleteReview(reviewId) {
        try {
          const response = await fetch(
            `http://localhost:3000/api/delete-review/${reviewId}`,
            {
              method: "DELETE", // Using DELETE method for delete operation
            }
          );
          const data = await response.json();
          if (data.success == true) {
            return window.location.reload();
          }
          // Handle response as needed
        } catch (error) {
          console.error("Error deleting review:", error);
        }
      }

      // Display reviews in the table
      function displayReviews(reviews) {
        const reviewsBody = document.getElementById("reviewsBody");
        reviewsBody.innerHTML = "";
        reviews.forEach((review) => {
          const row = document.createElement("tr");
          row.innerHTML = `
        <td><img height="100" width="100" src=${
          review.image
        } alt="Not-found"></td>
        <td>${review.name}</td>
        <td>${review.rating}</td>
        <td >${review.review}</td>
        <td>${convertToIST(new Date(review.createdAt))}</td>
        <td>${review.show}</td>
        <td><button class="btn btn-warning btn-update" onclick="handleUpdateReview('${
          review._id
        }')">Update</button></td>
        <td><button class="btn btn-danger btn-delete" onclick="handleDeleteReview('${
          review._id
        }')">Delete</button></td>

      `;
          reviewsBody.appendChild(row);
        });
      }

      async function fetchContactus() {
        try {
          const response = await fetch("http://localhost:3000/api/allcontacts"); // Assuming '/api/reviews' is your endpoint
          const data = await response.json();
          console.log(data);
          if (data.success) {
            displayContacts(data.contactdata);
          } else {
            console.error(data.message);
          }
        } catch (error) {
          console.error("Error fetching reviews:", error);
        }
      }

      // Function to display contacts in the table
      function displayContacts(contacts) {
        const contactsBody = document.getElementById("contactBody"); // Corrected ID
        contactsBody.innerHTML = "";
        contacts.forEach((contact) => {
          const row = document.createElement("tr");
          row.innerHTML = `
        <td>${contact.uniqueID}</td>
        <td>${contact.name}</td>
        <td >${contact.email}</td>
        <td>${contact.subject}</td>
        <td>${contact.message}</td>
        <td>${convertToIST(new Date(contact.createdAt))}</td>
      `;
          contactsBody.appendChild(row);
        });
      }

      async function fetchEnquiries() {
        try {
          const response = await fetch(
            "http://localhost:3000/api/allenquiries"
          ); // Assuming '/api/reviews' is your endpoint
          const data = await response.json();
          console.log(data);
          if (data.success) {
            displayEnquiry(data.data);
          } else {
            console.error(data.message);
          }
        } catch (error) {
          console.error("Error fetching reviews:", error);
        }
      }

      // Function to display contacts in the table
      function displayEnquiry(enquiries) {
        const enquiryBody = document.getElementById("enquiryBody"); // Corrected ID
        enquiryBody.innerHTML = "";
        enquiries.forEach((enquiries) => {
          const row = document.createElement("tr");
          row.innerHTML = `
        <td>${enquiries.uniqueID}</td>
        <td>${enquiries.name}</td>
        <td >${enquiries.phone}</td>
        <td>${enquiries.email}</td>
        <td>${enquiries.college}</td>
        <td>${enquiries.course}</td>
        <td>${enquiries.coursePDF}</td>
        <td>${enquiries.address}</td>
        <td>${convertToIST(new Date(enquiries.createdAt))}</td>
      `;
          enquiryBody.appendChild(row);
        });
      }

      async function fetchEmployees() {
        try {
          const response = await fetch("http://localhost:3000/api/employees"); // Assuming '/api/employees' is your endpoint
          const data = await response.json();
          console.log(data);
          if (data.success==true) {
            displayEmployees(data.employees);
          } else {
            console.error(data.message);
          }
        } catch (error) {
          console.error("Error fetching reviews:", error);
        }
      }

      // Function to handle update employees
      async function handleUpdateEmployee(reviewId) {
        try {
          const response = await fetch(
            `http://localhost:3000/api/employees/${reviewId}`,
            {
              method: "PUT", // Assuming POST method is used for update
            }
          );
          const data = await response.json();
          if (data.success == true) {
            return window.location.reload();
          }
          // Handle response as needed
        } catch (error) {
          console.error("Error updating review:", error);
        }
      }

      // Function to handle delete employees
      async function handleDeleteEmployee(reviewId) {
        try {
          const response = await fetch(
            `http://localhost:3000/api/employees/${reviewId}`,
            {
              method: "DELETE", // Using DELETE method for delete operation
            }
          );
          const data = await response.json();
          if (data.success == true) {
            return window.location.reload();
          }
          // Handle response as needed
        } catch (error) {
          console.error("Error deleting review:", error);
        }
      }

      // Display reviews in the table
  function displayEmployees(employees) {
    const employeeBody = document.getElementById("employeeBody");
    
    employeeBody.innerHTML = "";
    employees.forEach((employee) => { // Iterate over employees array
      const joinedDate = new Date(employee.joinedOn);
        
        // Get the date components
        const year = joinedDate.getFullYear();
        const month = String(joinedDate.getMonth() + 1).padStart(2, '0'); // Adding 1 because January is 0
        const day = String(joinedDate.getDate()).padStart(2, '0');

        // Construct the date string in the desired format (YYYY-MM-DD)
        const formattedDate = `${day}-${month}-${year}`;
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${employee.fname} ${employee.lname}</td>
            <td>${employee.designation}</td>
            <td><img src=${employee.image} height="100" width="100" alt="Not-Found"></td>
            <td>${formattedDate}</td>
            <td><button class="btn btn-warning btn-update" onclick="handleUpdateEmployee('${employee._id}')">Update</button></td>
            <td><button class="btn btn-danger btn-delete" onclick="handleDeleteEmployee('${employee._id}')">Delete</button></td>
        `;
        employeeBody.appendChild(row);
    });
}

      window.onload = function () {
        fetchReviews();
        fetchContactus();
        fetchEnquiries();
        fetchEmployees();
      };
    </script>
    <script>
      function showReviews() {
        document.getElementById("reviewsTable").style.display = "table";
        document.getElementById("contactTable").style.display = "none";
        document.getElementById("enquiryTable").style.display = "none";
        document.getElementById("employeeTable").style.display = "none";
        document.getElementById("employee").style.display = "none";
      }
      function showContacts() {
        document.getElementById("reviewsTable").style.display = "none";
        document.getElementById("contactTable").style.display = "table";
        document.getElementById("enquiryTable").style.display = "none";
        document.getElementById("employeeTable").style.display = "none";
        document.getElementById("employee").style.display = "none";
      }
      function showEnquires() {
        document.getElementById("reviewsTable").style.display = "none";
        document.getElementById("contactTable").style.display = "none";
        document.getElementById("enquiryTable").style.display = "table";
        document.getElementById("employeeTable").style.display = "none";
        document.getElementById("employee").style.display = "none";
      }
      function showEmployee() {
        document.getElementById("reviewsTable").style.display = "none";
        document.getElementById("contactTable").style.display = "none";
        document.getElementById("enquiryTable").style.display = "none";
        document.getElementById("employeeTable").style.display = "table";
        document.getElementById("employee").style.display = "none";
      }
      function showAddEmployee() {
        document.getElementById("reviewsTable").style.display = "none";
        document.getElementById("contactTable").style.display = "none";
        document.getElementById("enquiryTable").style.display = "none";
        document.getElementById("employeeTable").style.display = "none";
        document.getElementById("employee").style.display = "block";
      }
    </script>

<script
src="https://upload-widget.cloudinary.com/latest/global/all.js"
type="text/javascript"
></script>

<script type="text/javascript">
var result;
var myWidget = cloudinary.createUploadWidget(
  {
    cloudName: "dohhbq1ly",
    uploadPreset: "dtp53xo0",
  },
  (error, res) => {
    if (!error && res && res.event === "success") {
      result = res;
      console.log("Done! Here is the image info: ", result.info);
    }
  }
);

document.getElementById("upload_widget").addEventListener(
  "click",
  function () {
    myWidget.open();
  },
  false
);

document
  .getElementById("addEmployeeForm")
  .addEventListener("submit", async function (event) {
    event.preventDefault();

    const fname = document.getElementById("fname").value;
    const lname = document.getElementById("lname").value;
    const designation = document.getElementById("designation").value;
    const joinedOn = document.getElementById("joinedOn").value;
    if (!result) {
      alert("Please upload an image.");
      return;
    }

    const image = result.info.secure_url;

    try {
      const response = await fetch("http://localhost:3000/api/employees", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          fname,
          lname,
          designation,
          image,
          joinedOn
        }),
      });

      const data = await response.json();

      if (response.ok) {
        // Login successful, redirect or perform any necessary action
        // window.location.href = "/admin/dashboard";
        alert("Employee Added");
        document.getElementById("addEmployeeForm").reset();
      } else {
        // Display error message
        alert(data.message);
      }
    } catch (error) {
      console.error("Error:", error);
    }
  });
</script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
